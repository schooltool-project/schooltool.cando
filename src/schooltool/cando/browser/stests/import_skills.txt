Tests for the global skills xls import
======================================

Log in as manager:

    >>> manager = browsers.manager
    >>> manager.ui.login('manager', 'schooltool')

We'll define a helper function for printing the form fields of skillsets and
skills.

    >>> def format_row(row):
    ...     label = row.query.xpath('td[1]').text
    ...     value = row.query.xpath('td[2]').text
    ...     return '%s: %s' % (label, value)

A school year is needed for importing skillsets and skills:

    >>> manager.ui.schoolyear.add('2012', '2012-01-01', '2012-12-31')

Let's import a file containing the SkillSets and Skills sheets:

    >>> import os
    >>> dirname = os.path.abspath(os.path.dirname(__file__))
    >>> filename = os.path.join(dirname, 'sample_data.xls')
    >>> manager.ui.import_global_skills(filename)

There should be no errors so we should be back at the School tab view:

    >>> manager.url
    u'http://localhost/manage'

Let's check the data.  Ther is one skillset called Carpentry.

    >>> manager.query.link('School').click()
    >>> manager.query.link('Skills').click()
    >>> manager.query.link('Skill Sets').click()
    >>> print manager.query_all.xpath('//table[@class="data"]//a').get_attribute('href')
    http://localhost/skills/carpentry

    >>> manager.query.link('Carpentry').click()
    >>> sel = 'table.form-fields tbody tr'
    >>> for row in manager.query_all.css(sel):
    ...     print format_row(row)
    Short label: Carp label
    External ID: ext_carp

    >>> print manager.query_all.xpath('//table[@class="data"]//a').get_attribute('href')
    http://localhost/skills/carpentry/hammering
    http://localhost/skills/carpentry/pounding
    http://localhost/skills/carpentry/whacking

    >>> manager.query.link('Pounding').click()
    >>> sel = 'table.form-fields tbody tr'
    >>> for row in manager.query_all.css(sel):
    ...     print format_row(row)
    Full description:
    Short label:
    Required: Yes
    External ID: ext_123

    >>> manager.query.link('Done').click()
    >>> manager.query.link('Hammering').click()
    >>> sel = 'table.form-fields tbody tr'
    >>> for row in manager.query_all.css(sel):
    ...     print format_row(row)
    Full description: This is hammering.
    Short label: Label
    Required: No
    External ID:

    >>> manager.query.link('Done').click()
    >>> manager.query.link('Whacking').click()
    >>> sel = 'table.form-fields tbody tr'
    >>> for row in manager.query_all.css(sel):
    ...     print format_row(row)
    Full description: Whacking desc.
    Short label:
    Required: No
    External ID:
